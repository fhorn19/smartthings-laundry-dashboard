<!DOCTYPE html>
<html>
<head>
  <title>SmartThings Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f0f;
      color: white;
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    #buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 600px;
    }

    button.btn {
      padding: 1.5rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 12px;
      background: #222;
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    button.btn.off {
      background: #2a2a2a;
      filter: brightness(0.7);
    }

    button.btn.on {
      background: #28a745;
    }

    button.btn:hover {
      filter: brightness(1.1);
      transform: scale(1.02);
    }

    .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .icon.on {
      color: gold;
    }

    .icon.off {
      color: grey;
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <h1>SmartThings Dashboard</h1>
  <div id="buttons"></div>

  <script>
    const token = localStorage.getItem('st_pat') || 'YOUR_PAT_HERE';
    const switches = [
      { id: "DEVICE_ID_1" },
      { id: "DEVICE_ID_2" },
      { id: "DEVICE_ID_3" },
      { id: "DEVICE_ID_4" }
    ];

    const headers = {
      "Authorization": "Bearer " + token,
      "Content-Type": "application/json"
    };

    async function getStatus(device) {
      const res = await fetch(`https://api.smartthings.com/v1/devices/${device.id}/status`, { headers });
      const json = await res.json();
      return json.components.main.switch.switch.value === 'on';
    }

    async function getLabel(device) {
      const res = await fetch(`https://api.smartthings.com/v1/devices/${device.id}`, { headers });
      const json = await res.json();
      const fullName = json.label || json.name || "Switch";
      return fullName.split(' ')[0]; // First word only
    }

    async function toggle(device, currentState) {
      const command = currentState ? "off" : "on";
      await fetch(`https://api.smartthings.com/v1/devices/${device.id}/commands`, {
        method: 'POST',
        headers,
        body: JSON.stringify({
          commands: [{ component: "main", capability: "switch", command }]
        })
      });
      updateButtons();
    }

    async function updateButtons() {
      const container = document.getElementById("buttons");
      container.innerHTML = "";

      for (let device of switches) {
        const [label, isOn] = await Promise.all([
          getLabel(device),
          getStatus(device)
        ]);

        const btn = document.createElement("button");
        btn.className = "btn " + (isOn ? "on" : "off");

        const icon = document.createElement("div");
        icon.className = "icon " + (isOn ? "on" : "off");
        icon.innerHTML = "ðŸ””";

        const text = document.createElement("div");
        text.innerText = `${label}\n(${isOn ? "ON" : "OFF"})`;

        btn.appendChild(icon);
        btn.appendChild(text);
        btn.onclick = () => toggle(device, isOn);
        container.appendChild(btn);
      }
    }

    updateButtons();
    setInterval(updateButtons, 5000); // Refresh every 5 seconds
  </script>
</body>
</html>
